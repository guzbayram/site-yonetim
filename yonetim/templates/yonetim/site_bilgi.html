

<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Site Bilgileri - {{ site.ad|default:"Yeni Site" }}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        body { background: #f0f2f5; }
        .site-info-container { max-width: 700px; margin: 40px auto; background: #fff; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); padding: 30px; }
        .site-title-display { font-weight: 600; text-align: center; margin-bottom: 25px; color: #333; font-size: 1.8rem;}
        .form-label {font-weight: 500;}
    </style>
</head>
<body>
    <div class="site-info-container">
        <h2 class="site-title-display">{{ site.ad|default:"Site Bilgilerini Girin" }}</h2>
        
        {% if messages %}
            {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
            {% endfor %}
        {% endif %}

        <form method="post" id="siteForm">
            {% csrf_token %}
            <div class="mb-3">
                <label for="site_adi_input" class="form-label">Site Adı</label>
                <input type="text" name="site_adi" id="site_adi_input" class="form-control" placeholder="Örn: Huzur Sitesi" required value="{{ site.ad|default:'' }}" />
            </div>
            <div class="mb-3">
                <label for="site_adresi" class="form-label">Site Adresi</label>
                <input type="text" name="site_adresi" id="site_adresi" class="form-control" placeholder="Örn: Örnek Mah. Test Cad. No:123" required value="{{ site.adres|default:'' }}" />
            </div>
            <div class="mb-3">
                <label for="yonetici_tel" class="form-label">Yönetici Telefon</label>
                <input type="text" name="yonetici_tel" id="yonetici_tel" class="form-control" placeholder="Örn: 5551234567" value="{{ site.yonetici_tel|default:'' }}" />
            </div>
            <div class="mb-3">
                <label for="aidat_miktari" class="form-label">Aylık Aidat Miktarı (₺)</label>
                <input type="number" name="aidat_miktari" id="aidat_miktari" class="form-control" placeholder="Örn: 250" step="0.01" value="{{ site.aidat_miktari|default_if_none:'' }}" />
            </div>

            <hr>
            <h5>Blok Bilgileri</h5>
            <div id="bloklar-container">
                {% if bloklar %}
                    {% for blok in bloklar %}
                    <div class="row mb-3 blok-row align-items-end">
                        <div class="col-md-5">
                            <label class="form-label-sm">Blok Adı</label>
                            <input type="text" name="blok_adi[]" class="form-control" placeholder="Örn: A Blok" required value="{{ blok.ad }}" />
                        </div>
                        <div class="col-md-5">
                            <label class="form-label-sm">Daire Sayısı</label>
                            <input type="number" name="daire_sayisi[]" class="form-control" placeholder="Örn: 10" min="1" required value="{{ blok.daire_sayisi }}" />
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn btn-sm btn-danger remove-blok w-100" onclick="removeBlok(this)">Kaldır</button>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="row mb-3 blok-row align-items-end">
                        <div class="col-md-5">
                            <label class="form-label-sm">Blok Adı</label>
                            <input type="text" name="blok_adi[]" class="form-control" placeholder="Örn: A Blok" required />
                        </div>
                        <div class="col-md-5">
                            <label class="form-label-sm">Daire Sayısı</label>
                            <input type="number" name="daire_sayisi[]" class="form-control" placeholder="Örn: 10" min="1" required />
                        </div>
                        <div class="col-md-2">
                             </div>
                    </div>
                {% endif %}
            </div>
            <div class="mb-3">
                <button type="button" class="btn btn-secondary w-100" id="add-blok">+ Blok Ekle</button>
            </div>
            <hr>
            <button type="submit" class="btn btn-primary w-100 mb-2">BİLGİLERİ KAYDET</button>
            <a href="{% url 'yonetim:panel' %}" class="btn btn-outline-secondary w-100">Panele Dön</a>
        </form>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            var siteAdiInput = document.getElementById("site_adi_input");
            var siteTitleDisplay = document.querySelector(".site-title-display");
            if (siteAdiInput && siteTitleDisplay) {
                siteAdiInput.addEventListener("input", function () {
                    siteTitleDisplay.textContent = siteAdiInput.value || "Site Bilgilerini Girin";
                });
            }

            document.getElementById("add-blok").onclick = function () {
                var container = document.getElementById("bloklar-container");
                var newBlokRow = document.createElement("div");
                newBlokRow.className = "row mb-3 blok-row align-items-end";
                newBlokRow.innerHTML = `
                    <div class="col-md-5">
                        <label class="form-label-sm">Blok Adı</label>
                        <input type="text" name="blok_adi[]" class="form-control" placeholder="Örn: B Blok" required />
                    </div>
                    <div class="col-md-5">
                        <label class="form-label-sm">Daire Sayısı</label>
                        <input type="number" name="daire_sayisi[]" class="form-control" placeholder="Örn: 8" min="1" required />
                    </div>
                    <div class="col-md-2">
                        <button type="button" class="btn btn-sm btn-danger remove-blok w-100" onclick="removeBlok(this)">Kaldır</button>
                    </div>
                `;
                container.appendChild(newBlokRow);
            };
        });

        function removeBlok(buttonEl) {
            // En az bir blok satırı kalmasını sağlamak için kontrol edebilirsiniz.
            // if (document.querySelectorAll(".blok-row").length > 1) {
            buttonEl.closest(".blok-row").remove();
            // } else {
            //     alert("En az bir blok olmalıdır.");
            // }
        }
    </script>
</body>
</html>